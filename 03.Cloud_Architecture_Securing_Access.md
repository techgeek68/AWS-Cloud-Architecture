---

# **AWS Cloud Architecting - Chapter 3: Securing Access**

---

## **Module 3 Objectives & Overview**

* Describe AWS Cloud security principles
* Explain IAM users, groups, and roles
* Understand how IAM policies determine permissions
* Apply security best practices to AWS architectures

---

## **1. AWS Security Fundamentals**

### **AWS Shared Responsibility Model**

#### **AWS Responsibility (Security OF the Cloud)**

* **Infrastructure**: Global infrastructure, regions, availability zones
* **Hardware**: Servers, storage, networking equipment
* **Software**: Compute, database, storage services
* **Physical Security**: Data center access, environmental controls

#### **Customer Responsibility (Security IN the Cloud)**

* **Identity & Access Management**: Users, groups, roles, policies
* **Data Protection**: Encryption, backups, classification
* **Network Security**: Security groups, NACLs, VPC configuration
* **Application Security**: Code security, API management
* **Operating Systems**: Patching, configuration management

### **Security Pillar - Well-Architected Framework**

#### **Design Principles**

1. Implement strong identity foundation
2. Maintain traceability (monitor, alert, audit)
3. Apply security at all layers
4. Automate security best practices
5. Protect data in transit and at rest
6. Keep people away from data
7. Prepare for security events

### **Principle of Least Privilege**

**Best Practices:**

* Grant only required permissions for tasks
* Start with minimum permissions
* Grant additional permissions as needed
* Revoke unnecessary permissions regularly

### **Encryption Strategies**

#### **Data in Transit**

* Use TLS/SSL cryptographic protocols
* VPN connections for secure remote access
* Direct Connect for private network connections

#### **Data at Rest - Client-Side Encryption**

```
Client → Encrypts Data → AWS (Encrypted Storage) → Client Decrypts
```

* **Control**: Client manages encryption keys
* **Security**: AWS never sees unencrypted data

#### **Data at Rest - Server-Side Encryption**

```
Client → AWS → Encrypts & Stores → Decrypts when requested
```

* **Convenience**: AWS manages encryption process
* **Options**: AWS KMS, CloudHSM, customer-provided keys

---

## **2. Authentication & Authorization**

### **Authentication vs Authorization**

| Aspect       | Authentication    | Authorization             |
| ------------ | ----------------- | ------------------------- |
| **Purpose**  | Verifies identity | Determines permissions    |
| **Question** | "Who are you?"    | "What can you do?"        |
| **Methods**  | Credentials, MFA  | IAM policies, permissions |

### **AWS Identity and Access Management (IAM)**

#### **IAM Core Features**

* Controls individual/group access to AWS resources
* Integrates with other AWS services
* Federated identity management
* Multi-factor authentication (MFA) support
* Granular permissions management

#### **IAM Terminology**

**IAM User**

* Person or application that can authenticate with AWS account
* **Best Practice**: Create individual users, avoid shared credentials

**IAM Group**

* Collection of IAM users with identical permissions
* **Best Practice**: Attach policies to groups, not individual users

**IAM Role**

* Identity for granting temporary permissions
* **Characteristics**:

  * Temporary security credentials
  * Not associated with one person
  * Can be assumed by people, applications, or services
  * Often used for delegation

**IAM Policy**

* JSON document defining resource access and permission levels

### **IAM Credentials & Best Practices**

#### **Credential Types**

* Access Keys (Access Key ID + Secret Key)
* Console Passwords
* SSH Keys
* Temporary Security Tokens (for roles)

#### **Security Best Practices**

1. Enable Multi-Factor Authentication (MFA)
2. Use temporary credentials for human users
3. Rotate access keys for long-term credentials
4. Use strong, complex passwords
5. Secure local credentials (don’t hardcode in applications)
6. Use AWS Organizations for multi-account management
7. Enable AWS CloudTrail for audit logging
8. Protect the root user

### **Root User Protection**

**Critical Tasks Only**:

* Changing account settings
* Restoring IAM user permissions
* Closing AWS account

**Daily Administration**:

* Create administrative user in IAM Identity Center
* Use admin user for routine tasks

### **IAM Roles - Common Use Cases**

#### **1. EC2 Application Roles**

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::my-bucket/*"
  }]
}
```

#### **2. Cross-Account Access**

* Allow users from one AWS account to access resources in another

#### **3. Mobile Applications**

* Grant temporary access to AWS resources from mobile apps

---

## **3. Authorization & IAM Policies**

### **Policy Types**

#### **Identity-Based Policies**

* **Attached to**: IAM users, groups, roles
* **Question**: "What does this identity have access to?"

#### **Resource-Based Policies**

* **Attached to**: AWS resources (S3 buckets, SQS queues, etc.)
* **Question**: "Who has access to this resource?"

### **Policy Evaluation Logic**

#### **Default Behavior**

* Default: All requests are denied
* Explicit Allow: Overrides default deny
* Explicit Deny: Overrides any allow

#### **Policy Evaluation Flow**

```
Request → Identity Policies → Resource Policies → Organization Policies → Permissions Boundary → Final Decision
```

### **Policy Evaluation Examples**

**Example 1: Conflicting Policies**

```yaml
Identity Policy: Allows GET, PUT, LIST on Bucket X
Resource Policy: Allows GET, LIST, DENIES PUT on Bucket X
Result: PUT is DENIED (Explicit Deny wins)
```

**Example 2: Complementary Policies**

```yaml
Identity Policy: Allows LIST on Bucket Y
Resource Policy: Allows GET, LIST on Bucket Y
Result: GET, LIST are ALLOWED (Resource policy grants additional access)
```

---

## **4. IAM Policy Structure & Analysis**

### **IAM Policy Document Format**

#### **Core Components**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "OptionalStatementId",
      "Effect": "Allow|Deny",
      "Action": ["service:action", "service:*"],
      "Resource": ["arn:aws:service:region:account:resource"],
      "Condition": {
        "condition-operator": {"condition-key": "value"}
      }
    }
  ]
}
```

### **Policy Element Details**

**Effect**

* "Allow": Permits the specified actions
* "Deny": Explicitly denies the specified actions

**Action**

* Format: "service:action" (e.g., "s3:GetObject")
* Wildcards: "s3:*", "ec2:Describe*"

**Resource**

* Format: Amazon Resource Name (ARN)
* Examples:

  * "arn:aws:s3:::my-bucket"
  * "arn:aws:s3:::my-bucket/*"
  * "arn:aws:ec2:us-east-1:123456789012:instance/i-12345"

**Condition**

* Context-based restrictions
* Common conditions:

  * `aws:SourceIp` - IP address restrictions
  * `aws:PrincipalArn` - Requester ARN restrictions
  * `ec2:InstanceType` - EC2 instance type restrictions

### **Policy Examples & Analysis**

**Example 1: Read-Only IAM Access**

```json
{
  "Version": "2012-10-17",
  "Statement": {
    "Effect": "Allow",
    "Action": ["iam:Get*", "iam:List*"],
    "Resource": "*"
  }
}
```

**Analysis**:

* Service: IAM service only
* Permissions: Read-only (Get*, List*)
* Cannot create users, groups, or policies

**Example 2: Conditional EC2 Termination**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "ec2:TerminateInstances",
      "Resource": "*"
    },
    {
      "Effect": "Deny",
      "Action": "ec2:TerminateInstances",
      "Condition": {
        "NotIpAddress": {"aws:SourceIp": ["192.0.2.0/24", "203.0.113.0/24"]}
      },
      "Resource": "*"
    }
  ]
}
```

**Analysis**:

* Allowed: Terminate instances from specified IP ranges
* Denied: Termination from any other IP addresses
* Security: IP-based access control

**Example 3: Instance Type Restrictions**

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Deny",
    "Action": ["ec2:RunInstances", "ec2:StartInstances"],
    "Resource": "arn:aws:ec2:*:*:instance/*",
    "Condition": {
      "StringNotEquals": {"ec2:InstanceType": ["t2.micro", "t2.small"]}
    }
  }]
}
```

**Analysis**:

* Denied: Launching/starting instances NOT t2.micro or t2.small
* Allowed: Launching/starting t2.micro or t2.small instances
* Cost Control: Prevents expensive instance types

---

## **5. Practical Implementation Guide**

### **IAM Best Practices Checklist**

**User & Group Management**

```bash
☐ Create individual IAM users (no shared credentials)
☐ Use groups to assign permissions to users
☐ Attach policies to groups, not individual users
☐ Require MFA for all human users
☐ Rotate access keys regularly
```

**Role Management**

```bash
☐ Use roles for EC2 applications (not access keys)
☐ Use roles for cross-account access
☐ Implement principle of least privilege
☐ Use temporary credentials whenever possible
```

**Policy Management**

```bash
☐ Use managed policies when available
☐ Test policies in non-production first
☐ Regularly review and audit permissions
☐ Implement permission boundaries for delegation
```

### **Common IAM Patterns**

**Administrative User Setup**

1. Root User: Create admin user with administrative permissions
2. Admin User: Use for daily administration tasks
3. Root User: Only for tasks requiring root privileges

**Developer Team Management**

```yaml
Scenario: Developer team needing VPC access for 9 months
Solution:
  - Create individual IAM users for each developer
  - Place users in "Developers" IAM group
  - Attach required policies to the group
  - Enable MFA for all users
```

**Cross-Account Resource Sharing**

```json
{
  "Version": "2012-10-17",
  "Statement": {
    "Effect": "Allow",
    "Principal": {"AWS": "arn:aws:iam::TARGET-ACCOUNT:root"},
    "Action": "s3:*",
    "Resource": ["arn:aws:s3:::shared-bucket", "arn:aws:s3:::shared-bucket/*"]
  }
}
```

---

## **6. Certification Exam Strategy**

### **Common Question Patterns**

**Scenario: Team Access Requirements**
Key Indicators:

* Team members likely to change
* Temporary project access
* Multiple users with same permissions

Correct Approach:

* Create individual IAM users
* Place in IAM group
* Attach policies to group

**Scenario: Application Access**
Key Indicators:

* Application running on EC2
* Need to access S3/DynamoDB
* Secure credential management

Correct Approach:

* Use IAM roles for EC2
* Attach policy to role
* Assign role to EC2 instance

### **Exam Question Analysis**

```
Question: "Team of developers needs VPC access for 9 months. Team members likely to change."
Correct Answer: Create individual IAM users, place in group, attach policies to group
```

### **Critical Exam Concepts**

**Policy Evaluation Order**

1. Explicit Deny in any policy → Request DENIED
2. No Explicit Allow in any policy → Request DENIED
3. Explicit Allow without Deny → Request ALLOWED

**Root User vs IAM User**

* Root User: Full account access - use only when necessary
* IAM User: Daily administration - follow least privilege

---

## **7. Hands-On Lab Focus**

**Exploring IAM Lab Tasks**

1. Experiment with IAM policies
2. Add users to IAM groups
3. Use IAM sign-in URL

**Key Learning Points**

* Policy attachment locations
* Managed policy updates
* Custom sign-in URL behavior

---

## **8. Real-World Application - Café Scenario**

**Security Considerations**

* Frank & Martha: Non-technical owners → Minimal access
* Sofía: Technical manager → Administrative access
* Nikhil: Employee with design skills → Limited access
* Consultants: Temporary, audited permissions

**Implementation Strategy**

```yaml
IAM Structure:
  Admin Group:
    - Sofía (Full administrative access with MFA)
  
  Operations Group:  
    - Nikhil (S3, CloudFront access for design assets)
  
  External Group:
    - Consultants (Temporary, scoped permissions)
  
  Root User:
    - Frank & Martha (Emergency access only)
```

---

## **Key Success Factors**

**Certification Focus**

* Understand policy evaluation logic
* Know when to use users vs groups vs roles
* Apply principle of least privilege
* Recognize root user responsibilities

**Practical Implementation**

* Use groups for team permission management
* Implement roles for application access
* Enable MFA for all human users
* Regular permission audits and cleanup

**Security Mindset**

* Default deny as a starting point
* Explicit allows for required access only
* Monitor and log all access attempts
* Prepare for security incident response

---

